@model Paginate<GetAllProductVM>

@{
    int count = (Model.CurrentPage - 1) * 5 + 1;
    List<GetAllProductVM> datas = Model.Datas.DistinctBy(m => m.Id).ToList();
}

<div class="col-lg-12 grid-margin stretch-card">
    <div class="card">
        <div class="card-body">
            <h4 class="card-title">Products</h4>
            <a class="btn btn-success btn-rounded btn-fw" asp-action="Create">
                <i class="mdi mdi-library-plus"></i>
            </a>
            <div class="table-responsive pt-3">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>
                                #
                            </th>
                            <th>
                                Image
                            </th>
                            <th>
                                Name
                            </th>
                            <th>
                                Price
                            </th>
                            <th>
                                Category
                            </th>
                            <th>
                                Tags
                            </th>
                            <th>
                                Settings
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in datas)
                        {
                            <tr>
                                <td>
                                    @count
                                </td>
                                <td>
                                    <img src="~/img/@item.MainImage" />
                                </td>
                                <td>
                                    @item.Name
                                </td>
                                <td>
                                    @item.Price
                                </td>
                                <td>
                                    @item.CategoryName
                                </td>
                                <td>
                                    @String.Join(", ", item.Tags)
                                </td>
                                <td>
                                    <div style="display: inline">
                                        <a asp-action="Detail" asp-route-id="@item.Id" class="btn btn-info btn-rounded btn-fw">
                                            <i class="mdi mdi-alert-circle-outline"></i>
                                        </a>
                                        <a asp-action="Update" asp-route-id="@item.Id" class="btn btn-primary btn-rounded btn-fw">
                                            <i class="mdi mdi-border-color"></i>
                                        </a>
                                        <button class="btn btn-danger btn-rounded btn-fw delete-product"
                                                data-id="@item.Id"
                                                data-url="@Url.Action("Delete", "Product", new { id = item.Id })">
                                            <i class="mdi mdi-delete"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            count++;
                        }
                    </tbody>
                </table>

                <nav aria-label="Page navigation example" style="margin-top: 15px; display:flex; justify-content: center;">
                    <ul class="pagination">
                        @* Previous Button *@
                        <li class="page-item @(Model.CurrentPage > 1 ? "" : "disabled")">
                            <a class="page-link" asp-action="Index" asp-route-page="@(Model.CurrentPage - 1)">Previous</a>
                        </li>

                        @{
                            int startPage = Math.Max(1, Model.CurrentPage - 2);
                            int endPage = Math.Min(Model.TotalPage, Model.CurrentPage + 2);

                            // İlk səhifə və 3 nöqtə
                            if (startPage > 1)
                            {
                                <li class="page-item"><a class="page-link" asp-action="Index" asp-route-page="1">1</a></li>
                                if (startPage > 2)
                                {
                                    <li class="page-item disabled"><span class="page-link">...</span></li>
                                }
                            }

                            // Orta səhifələr
                            for (int i = startPage; i <= endPage; i++)
                            {
                                <li class="page-item @(Model.CurrentPage == i ? "active" : "")">
                                    <a class="page-link" asp-action="Index" asp-route-page="@i">@i</a>
                                </li>
                            }

                            // Son səhifə və 3 nöqtə
                            if (endPage < Model.TotalPage)
                            {
                                if (endPage < Model.TotalPage - 1)
                                {
                                    <li class="page-item disabled"><span class="page-link">...</span></li>
                                }
                                <li class="page-item"><a class="page-link" asp-action="Index" asp-route-page="@Model.TotalPage">@Model.TotalPage</a></li>
                            }
                        }

                        @* Next Button *@
                        <li class="page-item @(Model.CurrentPage < Model.TotalPage ? "" : "disabled")">
                            <a class="page-link" asp-action="Index" asp-route-page="@(Model.CurrentPage + 1)">Next</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>